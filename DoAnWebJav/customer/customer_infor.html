<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thông tin người dùng</title>
    <link rel="stylesheet" href="./customer_infor.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        /* CSS cho nút đăng xuất */
        #logoutButton {
            padding: 8px 16px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        button#logoutButton {
            margin-left: 10px;
        }

        /* Hover effect */
        #logoutButton:hover {
            background-color: #d32f2f;
        }
    </style>
</head>

<body>
    <section id="header">
        <a href="#"><img src="/DoAnWebJav/images/fast-delivery1.png" class="logo" /></a>

        <div>
            <ul id="navbar">
                <li>
                    <a href="/DoAnWebJav/pageCustomer/Home_Customer.html">Trang chủ</a>
                </li>
                <li><a href="about.html">Tạo đơn</a></li>
                <li><a href="about.html">Các đơn</a></li>
                <li>
                    <a class="active" href="/DoAnWebJav/pageCustomer/inforCustomer.html">Thông tin</a>
                </li>
                <li>
                    <a id="user-info"><button id="logoutButton">Đăng xuất</button></a>
                </li>
            </ul>
        </div>
    </section>

    <section>
        <div class="container light-style flex-grow-1 container-p-y">
            <h4 class="font-weight-bold py-3 mb-4">Account settings</h4>
            <div class="card overflow-hidden">
                <div class="row no-gutters row-bordered row-border-light">
                    <div class="col-md-3 pt-0">
                        <div class="list-group list-group-flush account-settings-links">
                            <a class="list-group-item list-group-item-action active" data-toggle="list"
                                href="#account-general">Chung</a>
                            <a class="list-group-item list-group-item-action" data-toggle="list"
                                href="#account-info">Info</a>
                        </div>
                    </div>
                    <div class="col-md-9">
                        <div class="tab-content">
                            <form class="tab-pane fade active show form-user" id="account-general">
                                <div class="card-body media align-items-center">
                                    <img src="" alt class="d-block ui-w-80 imagecustomer" />
                                    <div class="media-body ml-4">
                                        <label class="btn btn-outline-primary">
                                            Upload new photo
                                            <input type="file" class="account-settings-fileinput" />
                                        </label>
                                        &nbsp;
                                        <button type="button" class="btn btn-default md-btn-flat">
                                            Reset
                                        </button>
                                        <div class="text-light small mt-1">
                                            Allowed JPG, GIF or PNG. Max size of 800K
                                        </div>
                                    </div>
                                </div>
                                <hr class="border-light m-0" />
                                <div class="card-body">
                                    <div class="form-group">
                                        <label class="form-label">Họ và Tên</label>
                                        <input type="text" class="form-control mb-1 username" value="nmaxwell" />
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Mật khẩu</label>
                                        <input type="text" class="form-control password" value="Nelle Maxwell" />
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">E-mail</label>
                                        <input type="text" class="form-control mb-1 email" value="nmaxwell@mail.com" />
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Địa chỉ</label>
                                        <input type="text" class="form-control address" value="Company Ltd." />
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Số điện thoại</label>
                                        <input type="text" class="form-control phone" value="Company Ltd." />
                                    </div>
                                </div>
                                <div class="text-right mt-3">
                                    <button type="submit" class="btn btn-primary btn-submit">
                                        Lưu</button>&nbsp;
                                    <button type="button" class="btn btn-default">Hủy</button>
                                </div>
                            </form>

                            <div class="tab-pane fade" id="account-info">
                                <div class="card-body pb-2">
                                    <div class="form-group">
                                        <label class="form-label">Bio</label>
                                        <textarea class="form-control" rows="5">
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris nunc arcu, dignissim sit amet sollicitudin iaculis, vehicula id urna. Sed luctus urna nunc. Donec fermentum, magna sit amet rutrum pretium, turpis dolor molestie diam, ut lacinia diam risus eleifend sapien. Curabitur ac nibh nulla. Maecenas nec augue placerat, viverra tellus non, pulvinar risus.</textarea>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Birthday</label>
                                        <input type="text" class="form-control" value="May 3, 1995" />
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Country</label>
                                        <select class="custom-select">
                                            <option>USA</option>
                                            <option selected>Canada</option>
                                            <option>UK</option>
                                            <option>Germany</option>
                                            <option>France</option>
                                        </select>
                                    </div>
                                </div>
                                <hr class="border-light m-0" />
                                <div class="card-body pb-2">
                                    <h6 class="mb-4">Contacts</h6>
                                    <div class="form-group">
                                        <label class="form-label">Phone</label>
                                        <input type="text" class="form-control" value="+0 (123) 456 7891" />
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Website</label>
                                        <input type="text" class="form-control" value />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>
        <script type="text/javascript"></script>
    </section>

    <!-- dùng để hiện username và logout -->

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var storedUserInformation = localStorage.getItem("userInfo");
            var parsedUserInformation = JSON.parse(storedUserInformation);

            var userInfoContainer = document.getElementById("user-info");

            if (parsedUserInformation) {
                var username = parsedUserInformation.username; // Giả sử tên người dùng được lưu trong userInfo
                var customer_id = parsedUserInformation.id;

                var userInfoElement = document.createElement("span");
                userInfoElement.textContent = "Chào, " + username; // Thông tin về người dùng

                userInfoContainer.appendChild(userInfoElement);

                logoutButton.addEventListener("click", function () {
                    // Xóa thông tin người dùng từ localStorage và chuyển hướng về trang đăng nhập
                    localStorage.removeItem("userInfo");
                    window.location.href = "/DoAnWebJav/public/login.html";
                });

                userInfoContainer.appendChild(logoutButton);
            } else {
                // Chuyển hướng về trang đăng nhập nếu thông tin người dùng không được tìm thấy
                window.location.href = "/DoAnWebJav/login/login.html";
            }
            // Lấy thông tin khách hàng

            // Địa chỉ URL của API
            const apiUrl = `https://localhost:7156/api/Driver/CustomerInfor?customerId=${customer_id}`;
            // api update customer
            const apiUpdateCustomer = `https://localhost:7156/api/Customer/updateCustomer?customerId=${customer_id}`;
            // Gửi yêu cầu GET sử dụng Fetch API
            fetch(apiUrl)
                .then((response) => {
                    // Kiểm tra xem phản hồi có thành công không (status code 200)
                    if (!response.ok) {
                        throw new Error(`Lỗi mạng: ${response.status}`);
                    }

                    // Chuyển đổi phản hồi sang đối tượng JSON
                    return response.json();
                })
                .then((data) => {
                    // Xử lý dữ liệu từ phản hồi ở đây
                    var username = document.querySelector(".username");
                    var imagecustomer = document.querySelector(".imagecustomer");
                    var password = document.querySelector(".password");
                    var email = document.querySelector(".email");
                    var address = document.querySelector(".address");
                    var phone = document.querySelector(".phone");
                    username.value = data.fullName;
                    password.value = data.password;
                    email.value = data.email;
                    address.value = data.address;
                    phone.value = data.phoneNumber;
                    imagecustomer.src = data.avatarImageLink
                        ? data.avatarImageLink
                        : "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTht9-qZYmqErdGMhJVbRf7BfhLRGspNWaFnR8nddu3x7Da7nqh23vsG6VWtG_VE9G9kLU&usqp=CAU";
                })
                .catch((error) => {
                    // Xử lý lỗi ở đây
                    console.error("Đã xảy ra lỗi:", error);
                });

            const form = document.querySelector(".form-user");
            console.log(form);
            form.addEventListener("submit", function (event) {
                event.preventDefault();
                // console.log(123);
                // xử lý update dữ liệu
                const customerName = document.querySelector(".username").value;
                const passwordCustomer = document.querySelector(".password").value;
                const emailCustomer = document.querySelector(".email").value;
                const addressCustomer = document.querySelector(".address").value;
                const phoneCustomer = document.querySelector(".phone").value;
                const updatedData = {
                    fullName: customerName,
                    password: passwordCustomer,
                    email: emailCustomer,
                    address: addressCustomer,
                    phoneNumber: phoneCustomer,
                };
                console.log(updatedData);
                fetch(apiUpdateCustomer, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(updatedData),
                })
                    .then((response) => {
                        if (!response.ok) {
                            throw new Error(`Lỗi mạng: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then((data) => {
                        // Xử lý phản hồi từ server (nếu cần)
                        console.log("Dữ liệu sau khi cập nhật:", data);
                    })
                    .catch((error) => {
                        // Xử lý lỗi ở đây
                        console.error("Đã xảy ra lỗi:", error);
                    });
            });
        });
    </script>
</body>

</html>