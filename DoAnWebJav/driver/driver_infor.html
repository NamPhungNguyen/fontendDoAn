<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thông tin người dùng</title>
    <link rel="stylesheet" href="./driver_infor.css" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      /* CSS cho nút đăng xuất */
      #logoutButton {
        padding: 8px 16px;
        background-color: #f44336;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
      }

      button#logoutButton {
        margin-left: 10px;
      }

      /* Hover effect */
      #logoutButton:hover {
        background-color: #d32f2f;
      }
    </style>
  </head>

  <body>
    <section id="header">
      <a href="#"
        ><img src="/DoAnWebJav/images/fast-delivery1.png" class="logo"
      /></a>

      <div>
        <ul id="navbar">
          <li>
            <a href="/DoAnWebJav/pageDriver/Home_Driver.html">Trang chủ</a>
          </li>
          <li><a href="about.html">Tìm kiếm</a></li>
          <li><a class="active" href="inforDriver.html">Thông tin</a></li>
          <li>
            <a id="user-info"><button id="logoutButton">Đăng xuất</button></a>
          </li>
        </ul>
      </div>
    </section>

    <section>
      <div class="container light-style flex-grow-1 container-p-y">
        <h4 class="font-weight-bold py-3 mb-4">Account settings</h4>
        <div class="card overflow-hidden">
          <div class="row no-gutters row-bordered row-border-light">
            <div class="col-md-3 pt-0">
              <div class="list-group list-group-flush account-settings-links">
                <a
                  class="list-group-item list-group-item-action active"
                  data-toggle="list"
                  href="#account-general"
                  >Chung</a
                >
                <a
                  class="list-group-item list-group-item-action"
                  data-toggle="list"
                  href="#account-change-password"
                  >Xe</a
                >
                <a
                  class="list-group-item list-group-item-action"
                  data-toggle="list"
                  href="#account-info"
                  >Info</a
                >
              </div>
            </div>
            <div class="col-md-9">
              <div class="tab-content">
                <form class="tab-pane fade active show form-user" id="account-general driverForm">
                  <div class="card-body media align-items-center">
                    <img src="" alt class="d-block ui-w-80 image_driver" />
                    <div class="media-body ml-4">
                      <label class="btn btn-outline-primary">
                        Upload new photo
                        <input type="file" class="account-settings-fileinput" />
                      </label>
                      &nbsp;
                      <button type="button" class="btn btn-default md-btn-flat">
                        Reset
                      </button>
                      <div class="text-light small mt-1">
                        Allowed JPG, GIF or PNG. Max size of 800K
                      </div>
                    </div>
                  </div>
                  <hr class="border-light m-0" />
                  <div class="card-body">
                    <div class="form-group">
                      <label class="form-label">Họ và Tên</label>
                      <input
                        type="text"
                        class="form-control mb-1 driver_name"
                        value="nmaxwell"
                      />
                    </div>
                    <div class="form-group">
                      <label class="form-label">Mật khẩu</label>
                      <input
                        type="text"
                        class="form-control password"
                        value="Nelle Maxwell"
                      />
                    </div>
                    <div class="form-group">
                      <label class="form-label">E-mail</label>
                      <input
                        type="text"
                        class="form-control mb-1 email"
                        value="nmaxwell@mail.com"
                      />
                    </div>
                    <div class="form-group">
                      <label class="form-label">Địa chỉ</label>
                      <input
                        type="text"
                        class="form-control address"
                        value="Company Ltd."
                      />
                    </div>
                    <div class="form-group">
                      <label class="form-label">Số điện thoại</label>
                      <input
                        type="text"
                        class="form-control phone"
                        value="Company Ltd."
                      />
                    </div>
                  </div>
                  <div class="text-right mt-3">
                    <button type="submit" class="btn btn-primary btn-submit">
                      Lưu</button
                    >&nbsp;
                    <button type="button" class="btn btn-default">Hủy</button>
                  </div>
                </form>

                <div class="tab-pane fade" id="account-change-password">
                  <div class="card-body pb-2">
                    <div class="form-group">
                      <label class="form-label">Tên loại xe</label>
                      <input type="text" class="form-control name_verhicle" />
                    </div>
                    <div class="form-group">
                      <label class="form-label">Số bánh xe</label>
                      <input type="text" class="form-control number_wheel" />
                    </div>
                    <div class="form-group">
                      <label class="form-label">Trạng thái</label>
                      <input
                        type="text"
                        hidden
                        class="form-control status_verhicle"
                      />
                      <input
                        type="radio"
                        name="status_verhicle"
                        class="status_verhicle_true"
                        value=""
                      />Hoạt động
                      <input
                        type="radio"
                        name="status_verhicle"
                        class="status_verhicle_false"
                        value=""
                      />Dừng kinh doanh
                    </div>
                  </div>
                </div>

                <div class="tab-pane fade" id="account-info">
                  <div class="container">
                    <h2>Danh sách các xe</h2>
                    <!-- Button trigger modal -->
                    <button
                      type="button"
                      class="btn btn-primary"
                      data-toggle="modal"
                      data-target="#exampleModalCenter"
                    >
                      Tạo xe
                    </button>
                    <!-- Modal -->
                    <div
                      class="modal fade"
                      id="exampleModalCenter"
                      tabindex="-1"
                      role="dialog"
                      aria-labelledby="exampleModalCenterTitle"
                      aria-hidden="true"
                    >
                      <div
                        class="modal-dialog modal-dialog-centered"
                        role="document"
                      >
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLongTitle">
                              Đăng ký xe
                            </h5>
                            <button
                              type="button"
                              class="close"
                              data-dismiss="modal"
                              aria-label="Close"
                            >
                              <span aria-hidden="true">&times;</span>
                            </button>
                          </div>
                          <div class="modal-body">
                            <form class="form-user">
                              <div class="form-group">
                                <label>Tên xe</label>
                                <input
                                  type="text"
                                  class="form-control"
                                  name="fullname"
                                  placeholder="Nhập tên xe"
                                />
                              </div>
                              <div class="form-group">
                                <label>Mô tả</label>
                                <input
                                  type="text"
                                  class="form-control"
                                  name="phone"
                                  placeholder="Nhập mô tả"
                                />
                              </div>
                              <div class="form-group">
                                <label>Cargo</label>
                                <input
                                  type="email"
                                  class="form-control"
                                  name="email"
                                  placeholder=""
                                />
                              </div>
                              <div class="form-group">
                                <label>fuelEfficiency</label>
                                <input
                                  type="number"
                                  class="form-control"
                                  name="age"
                                  placeholder=""
                                />
                              </div>
                              <div class="form-group">
                                <label>Trạng thái</label>
                                <div class="radio">
                                  <label class="checkbox-inline">
                                    <input
                                      type="radio"
                                      name="gender"
                                      checked="checked"
                                      value="true"
                                    />Hoạt động</label
                                  >
                                  <label class="checkbox-inline">
                                    <input
                                      type="radio"
                                      name="gender"
                                      value="false"
                                    />Ngừng hoạt động</label
                                  >
                                </div>
                              </div>
                              <button type="submit" class="btn btn-primary">
                                Save
                              </button>
                            </form>
                          </div>
                        </div>
                      </div>
                    </div>
                    <table id="table-user" class="table table-bordered">
                      <tr>
                        <th>Tên xe</th>
                        <th>Mô tả</th>
                        <th>Cargo</th>
                        <th>FuelEfficiency</th>
                        <th>Trạng thái</th>
                        <th>Action</th>
                      </tr>
                      <tr>
                        <td>Nguyen Thi No</td>
                        <td>0905009999</td>
                        <td>notn@gmail.com</td>
                        <td>22</td>
                        <td><span>Nam</span></td>
                        <td>
                          <a class="btn btn-primary btn-sm">Edit</a> |
                          <a class="btn btn-danger btn-sm">Del</a>
                        </td>
                      </tr>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <script
        data-cfasync="false"
        src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"
      ></script>
      <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>
      <script type="text/javascript"></script>
    </section>

    <!-- dùng để hiện username và logout -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var storedUserInformation = localStorage.getItem("userInfo");
        var parsedUserInformation = JSON.parse(storedUserInformation);

        var userInfoContainer = document.getElementById("user-info");

        if (parsedUserInformation) {
          var username = parsedUserInformation.username; // Giả sử tên người dùng được lưu trong userInfo
          var driver_id = parsedUserInformation.id; // Giả sử tên người dùng được lưu trong userInfo

          var userInfoElement = document.createElement("span");
          userInfoElement.textContent = "Chào, " + username; // Thông tin về người dùng

          userInfoContainer.appendChild(userInfoElement);

          logoutButton.addEventListener("click", function () {
            // Xóa thông tin người dùng từ localStorage và chuyển hướng về trang đăng nhập
            localStorage.removeItem("userInfo");
            window.location.href = "../public/login.html";
          });

          userInfoContainer.appendChild(logoutButton);
        } else {
          // Chuyển hướng về trang đăng nhập nếu thông tin người dùng không được tìm thấy
          window.location.href = "../public/login.html";
        }

        // Địa chỉ URL của API
        const apiUrl = `https://localhost:7156/api/Driver/DriverInfor?driverId=${driver_id}`;

        // api update driver
        const apiUpdateDriver = `https://localhost:7156/api/Driver/UpdateDriver?driverId=${driver_id}`;
        // Gửi yêu cầu GET sử dụng Fetch API

        fetch(apiUrl)
          .then((response) => {
            // Kiểm tra xem phản hồi có thành công không (status code 200)
            if (!response.ok) {
              throw new Error(`Lỗi mạng: ${response.status}`);
            }

            // Chuyển đổi phản hồi sang đối tượng JSON
            return response.json();
          })
          .then((data) => {
            // Xử lý dữ liệu từ phản hồi ở đây
            var dataDriver = data.driver;
            var vehicler = data.vehicle;
            var dataVehicler = vehicler[0].vehicle;
            // lấy thông tin driver
            var driver_name = document.querySelector(".driver_name");
            var image_driver = document.querySelector(".image_driver");
            var password = document.querySelector(".password");
            var email = document.querySelector(".email");
            var address = document.querySelector(".address");
            var phone = document.querySelector(".phone");
            driver_name.value = dataDriver.fullName;
            password.value = dataDriver.password;
            email.value = dataDriver.email;
            address.value = dataDriver.address;
            phone.value = dataDriver.phoneNumber;
            image_driver.src = dataDriver.avatarImageLink
              ? dataDriver.avatarImageLink
              : "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTht9-qZYmqErdGMhJVbRf7BfhLRGspNWaFnR8nddu3x7Da7nqh23vsG6VWtG_VE9G9kLU&usqp=CAU";

            var name_verhicle = document.querySelector(".name_verhicle");
            var number_wheel = document.querySelector(".number_wheel");
            var status_verhicle = document.querySelector(".status_verhicle");
            var status_verhicle_true = document.querySelector(
              ".status_verhicle_true"
            );
            var status_verhicle_false = document.querySelector(
              ".status_verhicle_false"
            );
            name_verhicle.value = dataVehicler.vehicleName;
            number_wheel.value = dataVehicler.wheel;
            status_verhicle.value = dataVehicler.status;

            if (dataVehicler.status) {
              status_verhicle_true.checked = true;
            } else {
              status_verhicle_false.checked = true;
            }
            // lấy thông tin xe
          })
          .catch((error) => {
            // Xử lý lỗi ở đây
            console.error("Đã xảy ra lỗi:", error);
          });


          const form = document.querySelector(".form-user");
          console.log(form);
         form.addEventListener("submit", function (event) {
            event.preventDefault(); // Ngăn chặn hành động mặc định của form
          // Xử lí update dữ liệu
          const driverName = document.querySelector(".driver_name").value;
          const password = document.querySelector(".password").value;
          const email = document.querySelector(".email").value;
          const address = document.querySelector(".address").value;
          const phone = document.querySelector(".phone").value;
          const updatedData = {
              fullName: driverName,
              password: password,
              email: email,
              address: address,
              phoneNumber: phone,
          };
          console.log(updatedData);
          fetch(apiUpdateDriver, {
            method: "PUT", // hoặc 'PUT' tùy thuộc vào API của bạn
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(updatedData),
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error(`Lỗi mạng: ${response.status}`);
              }
              return response.json();
            })
            .then((data) => {
              // Xử lý phản hồi từ server (nếu cần)
              console.log("Dữ liệu sau khi cập nhật:", data);
            })
            .catch((error) => {
              // Xử lý lỗi ở đây
              console.error("Đã xảy ra lỗi:", error);
            });
        });
      });
    </script>
  </body>
</html>
